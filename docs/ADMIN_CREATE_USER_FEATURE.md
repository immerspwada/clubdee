# ฟีเจอร์สร้างบัญชีผู้ใช้สำหรับ Admin

## ภาพรวม

Admin สามารถสร้างบัญชีผู้ใช้ใหม่ได้โดยตรงผ่าน Admin Panel โดยไม่ถูก rate limit

## การเข้าถึง

### วิธีที่ 1: จากหน้า Admin Dashboard
1. Login เป็น Admin
2. ไปที่ `/dashboard/admin`
3. คลิกการ์ด **"สร้างบัญชีผู้ใช้"** (สีน้ำเงิน)

### วิธีที่ 2: URL โดยตรง
- ไปที่: `/dashboard/admin/create-user`

---

## ฟีเจอร์

### 1. สร้างบัญชีผู้ใช้ทุกประเภท
- ✅ **Admin** - ผู้ดูแลระบบ (สิทธิ์เต็ม)
- ✅ **Coach** - โค้ช (จัดการตารางฝึก, บันทึกผล, อนุมัติใบสมัคร)
- ✅ **Athlete** - นักกีฬา (ดูตารางฝึก, เช็คอิน, ดูผลการฝึก)

### 2. สร้างรหัสผ่านอัตโนมัติ
- สร้างรหัสผ่านแบบสุ่มที่ปลอดภัย (12 ตัวอักษร)
- คลิกปุ่มรีเฟรชเพื่อสร้างรหัสผ่านใหม่
- หรือกรอกรหัสผ่านเองได้

### 3. ไม่ถูก Rate Limit
- ใช้ Admin API ของ Supabase
- สร้างบัญชีได้ทันที ไม่ต้องรอ
- ไม่จำกัดจำนวนครั้ง

### 4. สร้าง Records อัตโนมัติ
- สร้าง `profiles` record
- สร้าง `user_roles` record
- สร้าง `athletes` record (สำหรับ Athlete)
- Assign ให้กับ club แรกในระบบ (สำหรับ Coach/Athlete)

### 5. แสดงข้อมูล Login
- แสดงอีเมลและรหัสผ่านหลังสร้างสำเร็จ
- มีปุ่มคัดลอกสำหรับแต่ละฟิลด์
- แนะนำให้ส่งข้อมูลให้ผู้ใช้

---

## วิธีใช้งาน

### ขั้นตอนการสร้างบัญชี

1. **กรอกข้อมูล:**
   - **อีเมล** (required): อีเมลของผู้ใช้
   - **ชื่อ-นามสกุล** (required): ชื่อเต็มของผู้ใช้
   - **บทบาท** (required): เลือก Admin, Coach, หรือ Athlete
   - **รหัสผ่าน** (required): ใช้รหัสผ่านที่สร้างอัตโนมัติหรือกรอกเอง

2. **คลิก "สร้างบัญชีผู้ใช้"**

3. **รับข้อมูล Login:**
   - ระบบจะแสดงอีเมล, รหัสผ่าน, และบทบาท
   - คลิกปุ่มคัดลอกเพื่อคัดลอกข้อมูล

4. **ส่งข้อมูลให้ผู้ใช้:**
   ```
   บัญชีของคุณถูกสร้างเรียบร้อยแล้ว!
   
   Email: xxx@example.com
   Password: Abc123XYZ!@#
   
   กรุณา login ที่: [URL]/login
   แนะนำให้เปลี่ยนรหัสผ่านหลัง login
   ```

---

## API Endpoint

### POST `/api/admin/create-user`

**สิทธิ์:** Admin only

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePassword123!",
  "full_name": "ชื่อ นามสกุล",
  "role": "athlete",
  "club_id": "optional-club-id"
}
```

**Response (Success):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com"
  },
  "message": "User created successfully"
}
```

**Response (Error):**
```json
{
  "error": "Error message"
}
```

---

## การทำงานภายใน

### 1. ตรวจสอบสิทธิ์
- ตรวจสอบว่าผู้เรียกใช้เป็น Admin
- ตรวจสอบจาก `profiles.role` และ `user_roles.role`

### 2. สร้างบัญชี
- ใช้ `supabase.auth.admin.createUser()` (bypass rate limit)
- ตั้งค่า `email_confirm: true` (ไม่ต้องยืนยันอีเมล)

### 3. สร้าง Profile
- สร้าง record ใน `profiles` table
- ตั้งค่า role และ club_id

### 4. สร้าง User Roles
- สร้าง record ใน `user_roles` table
- บันทึกบทบาทของผู้ใช้

### 5. สร้าง Athlete Record (ถ้าเป็น Athlete)
- สร้าง record ใน `athletes` table
- แยกชื่อ-นามสกุล
- ตั้งค่าเริ่มต้น (วันเกิด, เบอร์โทร)

---

## สถานการณ์การใช้งาน

### สถานการณ์ที่ 1: ผู้ใช้ถูก Rate Limit
**ปัญหา:** ผู้ใช้ลองสมัครหลายครั้ง ถูก rate limit

**วิธีแก้:**
1. ไปที่ `/dashboard/admin/create-user`
2. กรอกข้อมูลผู้ใช้
3. สร้างบัญชี
4. ส่งข้อมูล login ให้ผู้ใช้

**เวลาที่ใช้:** 2-3 นาที

---

### สถานการณ์ที่ 2: สร้างบัญชี Coach ใหม่
**ปัญหา:** ต้องการเพิ่ม Coach ใหม่

**วิธีทำ:**
1. ไปที่ `/dashboard/admin/create-user`
2. เลือกบทบาท: **Coach**
3. กรอกข้อมูล
4. สร้างบัญชี
5. ส่งข้อมูล login ให้ Coach

**ผลลัพธ์:**
- Coach สามารถ login ได้ทันที
- มีสิทธิ์จัดการตารางฝึกและนักกีฬา

---

### สถานการณ์ที่ 3: สร้างบัญชี Admin เพิ่ม
**ปัญหา:** ต้องการเพิ่ม Admin อีกคน

**วิธีทำ:**
1. ไปที่ `/dashboard/admin/create-user`
2. เลือกบทบาท: **Admin**
3. กรอกข้อมูล
4. สร้างบัญชี
5. ส่งข้อมูล login ให้ Admin คนใหม่

**ผลลัพธ์:**
- Admin ใหม่มีสิทธิ์เต็มในระบบ
- สามารถจัดการทุกอย่างได้

---

## Best Practices

### ✅ ควรทำ:
1. **ใช้รหัสผ่านที่แข็งแรง**
   - ใช้รหัสผ่านที่สร้างอัตโนมัติ (แนะนำ)
   - หรือกรอกรหัสผ่านที่มีอย่างน้อย 8 ตัวอักษร

2. **ส่งข้อมูลผ่านช่องทางที่ปลอดภัย**
   - ส่งผ่าน Email ส่วนตัว
   - ส่งผ่าน Line/WhatsApp ส่วนตัว
   - ไม่ส่งผ่าน public chat

3. **แนะนำให้เปลี่ยนรหัสผ่าน**
   - บอกผู้ใช้ให้เปลี่ยนรหัสผ่านหลัง login ครั้งแรก
   - อธิบายวิธีเปลี่ยนรหัสผ่าน

4. **บันทึกข้อมูล**
   - บันทึกว่าสร้างบัญชีให้ใคร เมื่อไหร่
   - เก็บข้อมูลไว้สำหรับอ้างอิง

### ❌ ไม่ควรทำ:
1. **ใช้รหัสผ่านที่ง่ายเกินไป**
   - ❌ password123
   - ❌ 12345678
   - ❌ ชื่อผู้ใช้

2. **แชร์รหัสผ่านผ่านช่องทางที่ไม่ปลอดภัย**
   - ❌ Public chat
   - ❌ Social media
   - ❌ SMS (ถ้าไม่จำเป็น)

3. **สร้างบัญชีโดยไม่ได้รับการร้องขอ**
   - ต้องมีการร้องขอจากผู้ใช้ก่อน
   - หรือได้รับอนุมัติจากผู้บริหาร

4. **ลืมแจ้งผู้ใช้**
   - ต้องส่งข้อมูล login ให้ผู้ใช้
   - ต้องอธิบายวิธีใช้งาน

---

## คำถามที่พบบ่อย (FAQ)

### Q1: สร้างบัญชีแล้วผู้ใช้ต้องทำอะไรต่อ?
**A:** ผู้ใช้ต้อง:
1. Login ด้วยอีเมลและรหัสผ่านที่ได้รับ
2. เปลี่ยนรหัสผ่าน (แนะนำ)
3. กรอกข้อมูลส่วนตัวให้ครบถ้วน (สำหรับ Athlete)

### Q2: ถ้าสร้างบัญชีแล้วเกิด error?
**A:** ตรวจสอบ:
- อีเมลซ้ำหรือไม่ (ต้องไม่ซ้ำ)
- รหัสผ่านถูกต้องหรือไม่ (อย่างน้อย 8 ตัวอักษร)
- มี club ในระบบหรือไม่ (สำหรับ Coach/Athlete)

### Q3: ผู้ใช้ลืมรหัสผ่านที่ Admin สร้างให้?
**A:** ผู้ใช้สามารถ:
1. ใช้ฟีเจอร์ "ลืมรหัสผ่าน" ในหน้า login
2. หรือติดต่อ Admin เพื่อ reset รหัสผ่าน

### Q4: สามารถสร้างบัญชีได้กี่บัญชี?
**A:** ไม่จำกัด! เพราะใช้ Admin API ไม่ถูก rate limit

### Q5: ต้องมี club ก่อนถึงจะสร้างบัญชี Coach/Athlete ได้หรือไม่?
**A:** ไม่จำเป็น แต่แนะนำให้มี:
- ถ้ามี club: จะ assign ให้กับ club แรกอัตโนมัติ
- ถ้าไม่มี club: สร้างบัญชีได้ แต่ไม่มี club_id

### Q6: ความแตกต่างระหว่างหน้านี้กับ Rate Limit Management?
**A:**
- **Create User** (`/dashboard/admin/create-user`):
  - เน้นการสร้างบัญชีผู้ใช้ทุกประเภท
  - เลือก role ได้ (Admin, Coach, Athlete)
  - UI เรียบง่าย เน้นการสร้างบัญชี

- **Rate Limit Management** (`/dashboard/admin/rate-limits`):
  - เน้นการช่วยเหลือผู้ใช้ที่ถูก rate limit
  - แสดงสถิติการสมัคร
  - แสดงรายการผู้ใช้ล่าสุด
  - สร้างบัญชี Athlete เท่านั้น

---

## ไฟล์ที่เกี่ยวข้อง

### Frontend
- `app/dashboard/admin/create-user/page.tsx` - หน้าสร้างบัญชีผู้ใช้
- `app/dashboard/admin/page.tsx` - Admin dashboard (มีลิงก์)

### Backend
- `app/api/admin/create-user/route.ts` - API endpoint

### Components
- `components/ui/alert.tsx` - Alert component
- `components/ui/select.tsx` - Select component
- `components/ui/input.tsx` - Input component
- `components/ui/button.tsx` - Button component

### Documentation
- `docs/ADMIN_RATE_LIMIT_MANAGEMENT.md` - คู่มือ Rate Limit Management
- `docs/RATE_LIMIT_USER_GUIDE.md` - คู่มือสำหรับผู้ใช้
- `RATE_LIMIT_SOLUTION.md` - วิธีแก้ปัญหา Rate Limiting

---

## สรุป

ฟีเจอร์สร้างบัญชีผู้ใช้ช่วยให้ Admin:
- ✅ สร้างบัญชีได้ทันที ไม่ถูก rate limit
- ✅ สร้างบัญชีทุกประเภท (Admin, Coach, Athlete)
- ✅ สร้างรหัสผ่านที่ปลอดภัยอัตโนมัติ
- ✅ ช่วยเหลือผู้ใช้ที่ถูก rate limit ได้ทันที
- ✅ จัดการผู้ใช้ในระบบได้อย่างมีประสิทธิภาพ

**เวลาที่ใช้:** 2-3 นาทีต่อบัญชี

**ผลลัพธ์:** ผู้ใช้สามารถ login และใช้งานได้ทันที
